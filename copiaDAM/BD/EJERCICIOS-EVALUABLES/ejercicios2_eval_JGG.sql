CREATE DATABASE EXERCISES_2
GO
USE EXERCISES_2
CREATE TABLE PROVINCIA(
	codProv	INT	NOT NULL,
	nombre	VARCHAR(200) NOT NULL

	CONSTRAINT PK_PROVINCIA PRIMARY KEY (codProv)
);
GO
CREATE TABLE MUNICIPIO(
	codMuni	INT	NOT NULL,
	codProv	INT	NOT NULL,
	nombre	VARCHAR(200) NOT NULL

	CONSTRAINT PK_MUNICIPIO PRIMARY KEY (codMuni,codProv)
	CONSTRAINT FK_PROVINCIA_MUNICIPIO FOREIGN KEY (codProv)
		REFERENCES PROVINCIA(codProv),
);
GO
CREATE TABLE IMPUESTO(
	codImpuesto INT IDENTITY,
	codMuni	INT NOT NULL,
	codProv	INT	NOT NULL,
	fechaMax	DATE NOT NULL,
	importe	DECIMAL(5,2) NOT NULL,
	anyo	CHAR(4) NOT NULL

	CONSTRAINT PK_IMPUESTO PRIMARY KEY (codImpuesto)
	CONSTRAINT FK_PROVINCIA_IMPUESTO  FOREIGN KEY (codProv)
		REFERENCES PROVINCIA(codProv),
	CONSTRAINT FK_MUNICIPIO_IMPUESTO FOREIGN KEY (codMuni, codProv)
		REFERENCES MUNICIPIO(codMuni, codProv),
);
GO
CREATE TABLE IBI(
	codImpuesto INT	NOT NULL,
	valorCatastral	DECIMAL(9,2) NOT NULL,
	tipoImpositivo	DECIMAL(3,2) NOT NULL

	CONSTRAINT PK_IBI PRIMARY KEY (codImpuesto)
	CONSTRAINT FK_IMPUESTO_IBI FOREIGN KEY (codImpuesto)
		REFERENCES IMPUESTO(codImpuesto),
);
GO
CREATE TABLE IVTM(
	codImpuesto INT	NOT NULL,
	tipoVehiculo	VARCHAR(200) NOT NULL,
	caballos	DECIMAL(5,2) NOT NULL

	CONSTRAINT PK_IVTM PRIMARY KEY (codImpuesto)
	CONSTRAINT FK_IMPUESTO_IVTM FOREIGN KEY (codImpuesto)
		REFERENCES IMPUESTO(codImpuesto),
);
GO
CREATE TABLE IAE(
	codImpuesto INT	NOT NULL,
	factMediaAnual	DECIMAL(11,2) NOT NULL

	CONSTRAINT PK_IAE PRIMARY KEY (codImpuesto)
	CONSTRAINT FK_IMPUESTO_IAE FOREIGN KEY (codImpuesto)
		REFERENCES IMPUESTO(codImpuesto),
);
GO
CREATE TABLE CONTRIBUYENTE(
	NIF	INT	IDENTITY,
	nombre	VARCHAR(200)	NOT NULL,
	apellidos	VARCHAR(400)	NOT NULL,
	direccion	VARCHAR(500)	NOT NULL,
	codPostal	INT NOT NULL

	CONSTRAINT PK_CONTRIBUYENTE PRIMARY KEY (NIF)
);
GO
CREATE TABLE OFICINA(
	codOficina	INT IDENTITY,
	nombre	VARCHAR(200),
	direccion	VARCHAR(500)

	CONSTRAINT PK_OFICINA PRIMARY KEY (codOficina)
);
GO
CREATE TABLE PAGO(
	codImpuesto	INT IDENTITY,
	NIF	INT,
	codOficina	INT,
	fecha	SMALLDATETIME,
	forma	VARCHAR(100)

	CONSTRAINT PK_PAGO PRIMARY KEY (codImpuesto)
	CONSTRAINT FK_PAGO_CONTRIBUYENTE FOREIGN KEY (NIF)
		REFERENCES CONTRIBUYENTE(NIF),
	CONSTRAINT FK_PAGO_OFICINA FOREIGN KEY (codOficina)
		REFERENCES OFICINA(codOficina),
	CONSTRAINT FK_PAGO_IMPUESTO FOREIGN KEY (codImpuesto)
		REFERENCES IMPUESTO(codImpuesto),
);
GO