CREATE DATABASE EXERCISES_3;
GO
USE EXERCISES_3

CREATE TABLE CATEGORIES(
	CodCategory INT IDENTITY,
	name VARCHAR(100)	NOT NULL,
	VAT INT	NOT NULL

	CONSTRAINT PK_CATEGORIES PRIMARY KEY (CodCategory)
);
GO

CREATE TABLE HOTELS(
	codHotel	INT IDENTITY,
	name	VARCHAR(100)	NOT NULL,
	address	VARCHAR(500)	NOT NULL,
	phone	CHAR(13)	NOT NULL,
	codCategory	INT	NOT NULL

	CONSTRAINT PK_HOTELS PRIMARY KEY (codHotel),
	CONSTRAINT FK_CATEGORIES_HOTELS FOREIGN KEY (codCategory)
		REFERENCES CATEGORIES(codCategory)
);

CREATE TABLE ROOMS(
	codHotel	INT IDENTITY,
	codRoom	INT NOT NULL,
	typeRoom	VARCHAR(100)	NOT NULL,
	price	DECIMAL(5,2)	NOT NULL

	CONSTRAINT PK_ROOMS PRIMARY KEY (codHotel, codRoom),
	CONSTRAINT FK_HOTELS_ROOMS FOREIGN KEY (codHotel)
		REFERENCES HOTELS(codHotel)
);


CREATE TABLE CLIENTS(
	codClient	INT IDENTITY,
	name	VARCHAR(200)	NOT NULL,
	address	VARCHAR(300)	NOT NULL,
	phone	CHAR(13)	NOT NULL
	CONSTRAINT PK_CLIENTS PRIMARY KEY (codClient)
);


CREATE TABLE INDIVIDUALS(
	codClient	INT	NOT NULL,
	DNI	CHAR(13) NOT NULL

	CONSTRAINT PK_INDIVIDUALS PRIMARY KEY (codClient),
	CONSTRAINT FK_CLIENTS_INDIVIDUALS FOREIGN KEY (codClient)
		REFERENCES CLIENTS(codClient)
);
CREATE TABLE AGENCIES(
	codClient	INT	NOT NULL,
	nameAgency	VARCHAR(100) NOT NULL

	CONSTRAINT PK_AGENCIES PRIMARY KEY (codClient),
	CONSTRAINT FK_CLIENTS_AGENCIES FOREIGN KEY (codClient)
		REFERENCES CLIENTS(codClient)
);

CREATE TABLE BOOKINGS(
	codBooking	INT IDENTITY,
	codHotel	INT NOT NULL,
	codRoom	INT	NOT NULL, 
	codClient	INT NOT NULL,
	dateStart	SMALLDATETIME	NOT NULL,
	dateEnd	SMALLDATETIME,
	totalPrice	DECIMAL(5,2) NOT NULL

	CONSTRAINT PK_BOOKINGS PRIMARY KEY (codBooking)
	CONSTRAINT FK_BOOKINGS_ROOMS FOREIGN KEY (codHotel, codRoom)
		REFERENCES ROOMS(codHotel, codRoom),
	CONSTRAINT FK_BOOKINGS_CLIENTS FOREIGN KEY (codClient)
		REFERENCES CLIENTS(codClient)

);

