--CREATE DATABASE EXERCISES
--GO
--USE EXERCISES

CREATE TABLE GALLERIES(
	codGallery	INT IDENTITY,
	name	VARCHAR(200) NOT NULL,
	city	VARCHAR(200) NOT NULL,
	address	VARCHAR(300) NOT NULL,
	squaredMeters DECIMAL(5,2) NOT NULL

	CONSTRAINT PK_GALLERIES PRIMARY KEY (codGallery)
);
GO
CREATE TABLE SCHOOLS(
	codSchool	INT IDENTITY, 
	name	VARCHAR(200) NOT NULL, 
	country	VARCHAR(100) NOT NULL

	CONSTRAINT PK_SCHOOLS PRIMARY KEY (codSchool)
);
GO
CREATE TABLE PAINTERS(
	codPainter	INT IDENTITY, 
	name	VARCHAR(200) NOT NULL, 
	country	VARCHAR(100) NOT NULL, 
	codPainterMaster	INT, 
	codSchool	INT

	CONSTRAINT PK_PAINTERS PRIMARY KEY (codPainter)
	CONSTRAINT FK_PAINTERS_PAINTERS FOREIGN KEY (codPainterMaster)
		REFERENCES PAINTERS(codPainter),
	CONSTRAINT FK_SCHOOLS_PAINTERS FOREIGN KEY (codSchool)
		REFERENCES SCHOOLS(codSchool)
);
GO
CREATE INDEX index_painters
ON PAINTERS (name);
GO
DROP INDEX PAINTERS.index_painters;
GO
CREATE TABLE PICTURES (
	codPictures	INT IDENTITY,
	width DECIMAL(5,2),
	height DECIMAL(5,2),
	dimensions	AS  width*height,
	technique	VARCHAR(50),
	codGallery	INT,
	codPainter	INT,
	paintedDate	DATE
	
	CONSTRAINT PK_PICTURES PRIMARY KEY (codPictures)
	CONSTRAINT FK_GALLERIES_PICTURES FOREIGN KEY (codGallery)
		REFERENCES GALLERIES(codGallery)
);

GO
CREATE TABLE SPONSORS(
	codSponsor	INT IDENTITY, 
	name	VARCHAR(200) NOT NULL, 
	country	VARCHAR(100) NOT NULL

	CONSTRAINT PK_SPONSORS PRIMARY KEY (codSponsor)
);
GO
CREATE TABLE PAINTER_PATRON(
	codPainter INT, 
	codSponsor	INT

	CONSTRAINT PK_PAINTER_PATRON PRIMARY KEY (codPainter, codSponsor)
	CONSTRAINT FK_PAINTER_PATRON_PAINTERS FOREIGN KEY (codPainter)
		REFERENCES PAINTERS(codPainter),
	CONSTRAINT FK_PAINTER_PATRON_SPONSORS FOREIGN KEY (codSponsor)
		REFERENCES SPONSORS(codSponsor)
);
GO

--ALTER TABLE PICTURES
--ADD CONSTRAINT PK_PICTURES PRIMARY KEY (codPictures);
--ALTER TABLE GALLERIES 
--   ALTER COLUMN codGallery INT;

--description	VARCHAR(1000) DEFAULT 'Sin descripción',
--	price	DECIMAL(9,2) NOT NULL,
--	stock	DECIMAL(4,0) DEFAULT 0